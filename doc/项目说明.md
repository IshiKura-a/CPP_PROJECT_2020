# 需求分析

# 1 引言

### 1.1 编写目的

​	经过小组讨论，本项目拟实现一个能够进行**公式识别和计算**的软件。此文档对项目进行了需求分析，明确了软件的功能、性能和界面要求，以便更好地进行开发管理工作。

​	本文档的预期读者包括但不仅限于以下人员：

* 需求分析人员
* 测试人员
* 项目管理人员
* 功能实现人员
* 教职员工
* 学生

### 1.2 项目背景

| 表1 项目背景 |                                                              |
| :----------- | :----------------------------------------------------------: |
| 软件系统名称 |                       公式识别计算系统                       |
| 任务提出者   | 浙江大学2020年暑学期<br>C++项目管理和工程实践<br>公式识别计算组 |
| 开发者       | 浙江大学2020年暑学期<br/>C++项目管理和工程实践<br/>公式识别计算组 |
| 用户         |                        教职员工、学生                        |

**相关背景介绍**：

​	浙江大学C++项目管理和工程实践课程强调学生的动手实践。理论课上，老师深入介绍当前流行的C++开发流程，C++代码框架和C++使用倾向，实验课则让同学以3-4人为一个小组，完成一个符合要求的大作业，以锻炼同学的动手能力、协作能力和开发能力。

**相关定义**：

* 用户场景
  * 是软件工程或系统工程中对系统如何反应外界请求的描述，是一种通过用户的使用场景来获取需求的技术。


## 2 项目描述

### 2.1 项目提出及意义

​	在实际的学习和工作过程中，数学公式经常出现。人们常常会花费大量的时间在公式的输入和计算上。有时候，人们需要把纸质的公式变成电子版，这件事如果由人工来做，实在是费时费力。因此，公式识别和计算系统应运而生。它不仅能够由用户上传图片，识别图片中的公式、对公式进行简单的在线编辑，还可以由用户输入数据，进行公式的计算。有了这个系统，人们的工作量将会大幅度地降低，工作效率能够有质的提升。

### 2.2 项目具体内容介绍

​	公式识别和计算系统能够识别用户上传的公式图片，生成对应的Latex公式。对于生成的Latex公式，系统可以渲染公式的实际效果，也能对其进行编辑。此外，此系统可以由用户输入公式中变量的具体数值，进行计算，返回数值化的结果。

### 2.3 研究现状

​	在公式识别这一块，全世界有许多知名的软件和网站，如海马扫描、InftyReader、百度智能云和Mathpix等。其中，海马扫描识别出的公式是文本公式，不包含任何格式，而后三者可以返回可编辑的Latex公式，可用性更高。其中Mathpix无论是准确度还是性能都十分出色，甚至可以支持手写字体。对于公式的计算，wolframalpha这一款网站有非常好的实现。wolframalpha支持各类的公式计算。此外，它还可以解方程、数列迭代、计算概率、求积分等等，性能十分强大。

## 3 用户场景

### 3.1 用例

| 用例       | 识别公式                                                     |
| :--------- | :----------------------------------------------------------- |
| 主要参与者 | 用户                                                         |
| 目标       | 进行公式识别                                                 |
| 前提条件   | 联网                                                         |
| 触发器     | 点击导入按钮，选择图片                                       |
| 工作流程   | 1. 用户导入指定图片<br>2. 上传图片调用接口进行识别<br>3. 接收返回的json文件，进行解析<br>4. 显示Latex公式 |
| 异常       | 1. 导入后公式无法识别                                        |
| 优先级     | 必须实现                                                     |
| 何时可用   | 二次增量                                                     |
| 使用频率   | 经常                                                         |
| 使用方式   | 通过桌面版软件                                               |
| 次要参与者 | 无                                                           |

| 用例       | 公式计算                                                  |
| ---------- | :-------------------------------------------------------- |
| 主要参与者 | 用户                                                      |
| 目标       | 对公式进行计算                                            |
| 前提条件   | 公式成功识别，Latex公式没有语法错误                       |
| 触发器     | 用户确认计算                                              |
| 工作流程   | 1. 用户提交数据<br>2. 软件进行计算<br>3. 显示结果         |
| 异常       | 1. 用户提交数据无反应<br>2. 浮点异常<br>3. 计算符无法解析 |
| 优先级     | 必须实现                                                  |
| 何时可用   | 首次增量                                                  |
| 使用频率   | 经常                                                      |
| 使用方式   | 通过桌面版软件                                            |
| 次要参与者 | 无                                                        |

| 用例       | Latex公式编辑                       |
| ---------- | ----------------------------------- |
| 主要参与者 | 用户                                |
| 目标       | 进行Latex公式的编辑                 |
| 前提条件   | 文本框可视，用户发生编辑操作        |
| 触发器     | 用户对文本框进行编辑                |
| 工作流程   | 1. 对用户操作进行响应，更改文本内容 |
| 异常       | 1. 公式无法编辑                     |
| 优先级     | 必须实现                            |
| 何时可用   | 首次增量                            |
| 使用频率   | 有时                                |
| 使用方式   | 通过桌面版软件                      |
| 次要参与者 | 无                                  |

| 用例       | Latex公式渲染                                            |
| ---------- | -------------------------------------------------------- |
| 主要参与者 | 用户                                                     |
| 目标       | 对Latex公式进行渲染显示                                  |
| 前提条件   | 联网                                     |
| 触发器     | 用户光标离开文本框一定时间或提交应用请求                                     |
| 工作流程   | 1. 将公式上传，在线渲染<br>2. 下载svg文件<br>3. 显示图片 |
| 异常       | 1. 云端无法响应<br>2. 公式无法显示                       |
| 优先级     | 必须实现                                                 |
| 何时可用   | 首次增量                                                 |
| 使用频率   | 频繁                                                     |
| 使用方式   | 通过桌面版软件                                           |
| 次要参与者 | 无                                                       |

| 用例       | Latex渲染图片下载                                            |
| ---------- | ------------------------------------------------------------ |
| 主要参与者 | 用户                                                         |
| 目标       | 下载Latex渲染图片                                            |
| 前提条件   | 无                                                           |
| 触发器     | 用户提交下载请求                                             |
| 工作流程   | 1. 用户提交下载请求<br>2. 用户选择下载路径和形式<br>3. 下载图片 |
| 异常       | 1. 图片无法下载                                              |
| 优先级     | 可以实现                                                     |
| 何时可用   | 三次增量                                                     |
| 使用频率   | 有时                                                         |
| 使用方式   | 通过桌面版软件                                               |
| 次要参与者 | 无                                                           |

### 3.2 用例图

![用例图]( https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/01.svg)

## 4 验收标准

### 4.1 功能需求

#### 4.1.1  识别公式

* 由用户导入图片，调用接口，返回json数据（Latex公式）。
* 支持svg, jpg和png格式。

#### 4.1.2 公式编辑

* 支持正常的文本编辑。
* 不支持实时语法检查。
* 在用户光标离开编辑框一定时间或提交应用请求之后，隐藏文本框，进行Latex公式渲染。
* 在提交prettify请求之后，可以对公式进行美化。

#### 4.1.3 公式渲染

* 对于非法公式，提示公式不合法。
* 展示公式形式为svg格式。
* 在点击公式渲染区或提交编辑请求时，进入公式编辑模式。

#### 4.1.4 公式计算

* 软件返回所需要的变量，由用户提供数值，进行计算。
* 结果不提供解析值，只返回数值值。
* 支持基本初等函数，包括三角函数、指数、对数和幂函数。
* 支持数学常量$\pi$和$e$。
* 拟支持连加$\sum$和连乘$\prod$计算
* 拟支持特殊变量符号，如$\phi\text{, }\epsilon\text{, }\rho$等。
* 拟支持输入数据的简单数学表示，拟支持分数，基本初等函数和数学常数。
* 拟支持结果精度设置。
* 拟支持结果科学计数法展示。
* 不计划支持大数计算。

#### 4.1.5 渲染结果下载

* 支持多种图片形式，至少包括svg, jpg, png等形式。
* 支持文件路径设置，文件名设置。

### 4.2 性能需求

#### 4.2.1 系统配置

​	只支持Windows 10系统。

#### 4.2.2 访问容量

​	本软件初版只支持单用户访问。

#### 4.2.3 响应速度

​	本软件响应速度和用户网络状况大幅相关，因此很难有整体的性能要求。对于公式计算部分和公式编辑部分，响应时间应当小于1s。

### 4.3 可用性需求

​	界面整体应当简洁美观，布局合理，能够清晰呈现信息，突出重点内容。

#### 4.4 安全性需求

​	软件调用百度API的部分，因为内含用户的key信息，为了保证信息不被泄露，拟对其进行AES加密。

​	软件调用Mathpix的API的部分，因为使用的是临时令牌，不包含用户信息，所以不予加密。

### 4.5 可维护性需求

#### 4.5.1 可复原性需求

​	在程序崩溃之后，下次运行应当尽可能还原当时的数据。

#### 4.5.2 可测试性需求

​	系统的各个子模块都可以进行单元测试，在适当干预下，确保单元测试能显示系统中任意的中间结果，以清楚的描述方式说明系统的输出，根据要求显示所有的输入，跟踪及显示逻辑控制流程，显示带说明的错误信息，并适应软件开发每一阶段结束的检查要求。

#### 4.5.3 可扩展性需求

​	系统可以进行一定程度的拓展，例如在测试阶段可以选择在短时间内为系统添加一个小功能。

## 5 运行环境规定

### 5.1 客户端

​	操作系统为Windows 10，网络质量良好。对计算机无性能要求。

​	目前软件的推荐分辨率为1920*1080.

### 5.2 编译环境要求

* Qt 5.0+
* Visual Studio 2019
* 安装curl库，rapidjson库

## 6 开发技术规划

### 6.1 开发计划

![开发计划](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/07.png)

### 6.2 迭代计划与分工

* 第一轮迭代
  * MVVM框架搭建：徐江雨
  * GUI框架搭建：唐子豪
  * 表达式树设计：鞠紫盈、林炬乙 
  * 公式识别接口设计：徐江雨
  * 公式渲染接口设计：唐子豪
  * 公式识别令牌加密：唐子豪
* 第二轮迭代
  * 表达式树设计（Algorithm层）：鞠紫盈
  * GUI优化（View-ViewModel层）：唐子豪
  * 计算界面设计（View-ViewModel层）：林炬乙 
  * CppCurl封装测试，json解析（Model层）：徐江雨
  * 整体结构优化：徐江雨

### 6.3 开发工具

| 应用场景 |              工具              |
| :------: | :----------------------------: |
| 版本控制 |          Git, Github           |
| 开发环境 | Windows 10, Qt 5.14.2, VS 2019 |
| 编程语言 |             C++17              |
|   架构   |              MVVM              |
|   文档   |        markdown, Latex         |
| 图表制作 |    markdown, drawio, Office    |
| 交流协作 |           QQ, Trello           |
|    CI    |  AppVeyor（计划后续迭代实现）  |

### 6.4 目前进度

​	目前基本完成第二次迭代，在进行修整工作。

​	整体情况如下图所示：

![目前进度](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/08.png)

​	下方有状态栏，右下角点击后可以编辑Latex公式。

![当前进度2](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/09.png)