# 项目成果与总结

## 1 项目成果

## 1.1 实现功能概述

* 对用户上传的公式进行识别，并返回Latex公式。支持一定的手写公式，有两个备选的识别引擎(Baidu和MathPix)。
* 对于返回的Latex公式，用户可以进行编辑（点击Edit按钮或者点击公式渲染的图片区域），软件提供了对公式的美化（减少空格布局）和延迟渲染。
* 在鼠标离开公式编辑区域或点击Apply后对Latex公式进行渲染。
* 用户能够下载渲染后的公式图片，支持jpg, png, svg格式。
* 支持对编辑区的清空功能。
* 对于用户提供的Latex公式，在用户提供了合法的变量值之后，可以进行公式计算（支持**所有**数学运算），并且能够返回**解析解**和数值解（在需要的时候）。
* 为软件提供了一款暗色皮肤。
* 支持状态显示，可以在下方提示错误信息。
* 支持部分功能的快捷键设置。

## 1.2 功能展示

打开程序，界面如下，下方状态栏提示“Hello”：

![开始界面](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/20.png)

打开帮助，界面如下，点击下方的View Website可以访问Github上的项目仓库。

![帮助](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/21.png)

点击设置，可以设置识别引擎，选择后会在下方状态栏提示选择了哪种引擎(Baidu或Mathpix)

![识别引擎-1](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/22.png)

![识别引擎-2](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/23.png)

点击Load按钮或点击“文件-导入”或按下快捷键Ctrl+O可以导入图片，如果取消操作，会在状态栏中提示"Load Aborted"的错误信息，在没有新信息的情况下，错误信息会永久展示。

![导入终止](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/24.png)

正常情况下，会跳出以下窗口，导入图片支持jpg, png, jpeg和bmp：

![导入](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/25.png)

根据本地的网络状况，导入时间会有区别，导入后界面如图，右侧的Label显示了图片的信息：

![导入结果](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/26.png)

此时，点击下方的公式或右侧的Edit按钮，可以进入公式编辑模式。

![公式编辑](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/27.png)

当鼠标移开次区域3s或者点击Apply按钮后，编辑区域将会回到公式渲染结果的展示，这时，如果公式发生改变，那么将会重新渲染，同样响应时间和本地网络状况大幅度相关。

因为识别出的公式带有很多不必要的空格，所以我们可以使用Prettify按钮来去除不必要的空格。

![美化](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/28.png)

点击Reset会清空所有数据，回到开始界面。

除了导入图片以外，我们也可以直接点击下方的公式渲染展示区域，输入想要使用的公式。

![公式手动编辑](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/29.png)

按下Download按钮或是“文件-下载”或是Ctrl-S会对当前的渲染结果进行保存，支持jpg, svg和png格式。同样，取消保存会提示错误信息，下图中状态栏显示的是上次保存的终止，因为此次保存尚未完成，所以错误信息没有被覆盖。

![保存](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/30.png)

保存成功后，下方会有提示。

![保存成功](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/31.png)

点击Calculate按钮进入公式计算页面，右侧是可编辑表格，左下方显示的是需要进行计算的公式。用户需要输入正确合法的变量值，之后点击Calculate按钮会显示解析解，对于复杂的结果会提供数值解。

![公式计算界面](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/32.png)

调整变量的值，可以看见结果。

![公式计算-1](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/33.png)

![公式计算-2](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/34.png)

## 1.3 其他需要展示的项目成果

持续集成的建立。

![持续集成](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/35.png)

GitHub master分支commit情况：

![commit](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/36.png)

Trello协作情况：

![Trello](https://raw.githubusercontent.com/IshiKura-a/CPP_PROJECT_2020/master/doc/img/37.png)

## 2 总结

因为我们是四人小组，所以定的课题比较复杂，难度也很大。从前端的设计，到后端的数据处理，几乎每一个模块遇到了形形色色，令人匪夷所思的bug。在设计界面的时候，有的组员反应自己的界面缩在一起，并且控件的比例并不正确，然而这是前端开发者无法复现的内容，所以这是一个无法独立解决的问题，为了解决问题，小组成员在深夜2点仍在在讨论问题所在，尝试复现问题。经过排查，问题的原因在于Bug反馈者的电脑是4K 250%的放大倍率，而开发者是2K 125%，这之间差距过大，再加上QLabel控件中的设置不当，所以整个界面被挤压，比例失衡。通过获取系统分辨率，动态调整窗口大小，这一问题才得到解决。在许许多多诸如此类的神秘的Bug中，团队协作体现出了重大的作用，孤掌难鸣，一个人也很难处理这些形形色色的Bug，依靠众人的智慧，我们才能瞥见问题的一丝线索，然后顺藤摸瓜，得知全貌，找到解决方案。这整个过程，对于参与其中的所有小组成员来说，都是一个非常有收获的体验。

在项目实践中，需求并非一成不变的，在我们第二次迭代结束的组会上，小组成员反映了公式计算部分的诸多困难，确实因为我们需要实现复杂的$\sum$计算，简单的后缀表达式并没有办法处理这个问题，由于我们缺乏编译原理上的知识，所以项目进度一度停滞不前。在一次头脑风暴中，一个组员忽然想到了知名的公式计算网站Wolframalpha（这个软件在我们的需求分析中有提到过），然后我们企图爬取网站的计算结果，了解过程中得知网站提供了一套强大的API，公式计算的问题才得以解决。

就像我们上文提到的一样，我们小组在不断地交流的过程中，不断地前进。在这次项目实践中，每个人都学到许许多多的知识，无论是C++和Qt的语法，是GitHub, Trello, Appveyor这些工具的使用，还是MVVM的开发架构，我们从一无所知开始，到现在小试牛刀，这是项目实践带给我们的进步，我们在获取这些知识的途中，不断地查找资料，从CSDN查到Stack Overflow，找出问题，然后思考，找到解决方案，这个过程对我们来说是更加难能可贵的。

虽然疫情让我们分隔各地，交流变得更加困难，但是因为我们有团队合作的心，所以我们能够很好地完成我们的项目。

## 3 个人心得

### 3.1 唐子豪

这次小学期的项目实践让我第一次有了团队协作的感觉，无论是在交流协作上，还是在使用工具上，我都感受到了一个团队的存在。在这次项目实践中，我学习到了非常多的知识，一方面我熟悉了GitHub, Git, Trello, Appveyor 这些工具的使用方法，另一方面在高强度地用Qt写代码之下，我也对Qt，对C++17有了会更加深入的理解，学会使用了lambda表达式和std::any。在这次项目中，我工作的重头就是前端的编写。在这节课之前，我对Qt毫无概念，C++也是刚刚入门，在这十几天里，我遇到了许许多多诡异的问题，为了处理这些问题，我查阅了大量的手册，搜索了CSDN, Stack Overflow, Qt Forum，然后一个一个解决了。让我记忆犹新的是一个关于stylesheet的问题，Qt有自己的QSS，它实际上和CSS非常类似，我在编写stylesheet的时候，为了改进用户的体验，想要让鼠标滑过控件的时候改变控件的字体颜色，以显示清楚，但是对于QMenuBar，设置hover属性并不起作用，经过查阅才知道应当使用selected才行。我遇到的每一个问题，都让我对C++和Qt有了更加深刻的理解。

在交流协作的过程中，我也从队友身上学到了许多。有很多bug是和本地的环境有关，在前端最头疼的bug往往都是难以复现的，这个时候就需要远程和队友一起debug，一个记忆犹新的bug就是dpi适配的问题，我和队友为了解决bug，半夜两三点仍在测试与讨论，虽然当时很累，但是当bug解决的那一刻，我感到非常的高兴。团队合作就是取长补短的过程，我的队友掌握着和我掌握的不同的知识，所以在交流和协作的过程中，我逐渐从他们身上获取了我不曾了解的知识，这就是我的进步，我在不断的进步的过程中，不断地发现自己的不足，发现自己要知道、要学习的东西还有很多，路漫漫其修远兮，吾将上下而求索。这便是此行最大的收获。

### 3.2 徐江雨

尽管对小学期的合作情况并称不上满意，但我的确比以往熟悉了团队协作开发的流程，获得了许多经验。我们的工程用到了第三方库、自己编译的动态库，单个Solution内包含多个Project，因而不再是以往课程只需要按一下生成的简单情况，而是需要编写相应的脚本。这一需求在开始使用持续集成后更加凸显。我负责了工程文件的整理和CI的部署，时常需要手动编辑vcxproj，调整工程设置，编写生成事件脚本。在CI环境的配置上，我遇到了个尤其特殊的问题。我们组统一使用了vs+vs qt tools，这一由qt官方编写的插件使用了特殊的QtMsBuild作为编译工具，而appveyor并没有提供这一环境。面对这一冷门的问题，Qt的官方文档，stackoverflow等论坛均未提供解决方案。所幸vcxproj中qt tools留下的一些配置条目指明了方向。最终，我不得不把appdata/local下自己的QtMsBuild配置文件复制到工程中，然后在部署脚本中修改注册表，使得远程系统可以正常编译。

此外，我还对MVVM框架的工作方式有了清晰的理解，熟悉了一种前后端的数据交流方式。我尤其体会到了项目构建初期，在设计框架时预留扩展性的需要。在开发后期，我们碰上了预留的函数模板无法接收多个参数的问题，而这个模板贯穿了整个框架，想要修改它几乎需要完全的重构，导致我们不得不用实现多个函数的方式来妥协。在开发过程中团队的需求经常变化，开发早期对扩展性认识不足导致了开发后期一些工作碰到了难以克服的阻碍，这也是非常珍贵的教训。

### 3.3 林炬乙
小学期项目来到结尾,首先感谢老师和队友给了我很多指导,让我学会了怎么解决编译问题,我用的vs2017平台,队友想办法让我自己编译了.lib文件,成功解决了libcurl库的无法解析问题. 大一些项目的编译,会出现很多意想不到的问题,
甚至会有非常简单但又意想不到的编码错误,多个人协作可能编码从UTF8到UTF8BOM编译都会出错.同学使用了UTF8BOM,我使用UTF8打开就会显示没有声明,我重新保存了头文件即可编译.
我了解了包含库的调用,也让我了解了很多新颖的工具,如trello这样的分工工具.
一开始几天是学习了github,冲突发生的原因,git 的回滚,分支并用等具体问题,因为分支创建和删除很方便,每个新功能都可以新建分支再merge,还有本地和远程分支对应的关系.
然后学习MVVM框架,每一天感觉都学到了非常多的东西.也对工程上持续部署等有了概念,知道实际应用中不是文件传来传去,而是可以同时编写,可以方便地push,部署.
在其他同学的展示中,我还了解了用Jenkins+git自动化部署.持续集成,持续交付,持续部署在实际应用中,JENKINS从仓库拉取代码，然后全自动部署到测试服务器进行测试
然后qt有很多module,我从对qt框架一无所知,到几天学了很多qt的框架,属性,槽函数信号传递等内容.也对前端的布局工作有了一定了解.
队友指导我去学习好看的ui,指出我做的不足和C++工程中的常见错误,如变量is开头 用户会期望它是一个bool,让我受益匪浅.
这次课程让我加深了C++技术在实际工程应用中的理解.

### 3.4 鞠紫盈

本次小学期，首先感受到了团队合作和个人项目的巨大差别，也理解了团队协作中会出现各种各样的困难，例如功能很难整合，互相之间电脑环境配置不同导致项目不能在其他电脑上编译等等问题。
本次小学期，我最大的收获还是在新工具的认识方面，首先之只是被我当成资料库的github，其实在项目开发方面非常的优秀，可以做到项目的回滚、分支等，创建删除修改都很方便，也了解了trello这样的分工工具。
同时，这次也对MVVM框架有了初步了解，虽然还有很多具体实现的问题我没有完全明白，但依旧受益匪浅，也从其他同学的展示中了解了Jenkins+git自动化部署。
之前一直对Qt一无所知，本次也稍微有所入门，感谢同组同学对我很多基础问题的悉心指导，使我了解了关于Qt的框架、属性、信号槽和设计UI方面的知识。
同时本次小学期我也了解了许多设计习惯方面的知识，个人开发时候变量和函数设计随便一些不会有问题，但是团队协作时，要使得代码本身易懂十分重要，例如isxxx的函数，最好是bool类型；不能在头文件中为了方便随意引用很多库和命名空间，这样会对其他代码造成很多影响，以及vector的使用也较从前有了很大提高。
总体来说，这次的课程不仅加深了我对c++的理解，同时也让我了解了很多工具和规范，非常受益。

## 4 课程建议

从课堂第一轮迭代情况可以看出，很多同学对MVVM架构的理解不是非常深刻，所以后续开设此课程时可以在PPT上的MVVM部分加上一些更加细致的内容，目前PPT上MVVM相关的页数只有两页，再加上网络上CSDN质量层次不齐，同学们回顾起来有些困难。依据同样的原因，老师在上课展示百度的过程中也常会提到某段文字理解有些偏差，所以为了让同学们少走弯路，希望老师也可以把C++的一些全新特性包括在PPT当中，进行介绍。

由于疫情的原因，本次课程受到了一定程度的影响，没有及时开课，整体进度也遭到了打乱，所以这次短学期的课程安排不是非常的清晰，希望老师能再下次课程中提前提供一个“时间表”，明确课程进度的安排。

很多同学在课程之前都没有仔细学过Git和GitHub的使用，所以希望老师能够在下次授课中简要地介绍一下Git中各个指令的原理和注意事项，特别是在Merge过程中冲突的处理，分支的设立这些细节上的东西。

